# Investigation of Sliding Window Algos for Results Smoothing

## Lookbehind
### Methods
Lookbehind algorithms scan through mode predictions, and if they find a prediction that
is incongruous with previous predictions then it will change the current prediction based
on some kind of majority vote. This majority vote can be different percentages. Normally
we can just use a simple majority, but in other cases we can use a 60%, 70%, ...etc majority vote.
We can also use different window sizes, and in this experiment we evaluated window sizes
of 10-50 breaths. We processed all predictions in a separate array than raw predictions.
If we did not do this then the majority vote algorithm would never be able to detect a
ventilator mode switch.

We used a Random Forest algorithm here on only the training set with cross patient 10-fold K-Fold splits by patient.

Label key:

    0: VC
    1: PC
    3: PS
    4: CPAP
    6: PAV

### Majority Vote Results
10 breath window majority votes results:

    +-------+----------+-------------+-------------+-----------+
    | label | accuracy | sensitivity | specificity | precision |
    +-------+----------+-------------+-------------+-----------+
    |  0.0  |   1.0    |     1.0     |     1.0     |   0.999   |
    |  1.0  |  0.986   |    0.974    |    0.992    |   0.982   |
    |  3.0  |  0.983   |    0.978    |    0.986    |   0.977   |
    |  4.0  |  0.997   |    0.955    |    0.998    |   0.937   |
    |  6.0  |  0.998   |    0.995    |    0.998    |   0.985   |
    +-------+----------+-------------+-------------+—————+

20 breath window majority votes:

    +-------+----------+-------------+-------------+-----------+
    | label | accuracy | sensitivity | specificity | precision |
    +-------+----------+-------------+-------------+-----------+
    |  0.0  |   1.0    |     1.0     |     1.0     |   0.999   |
    |  1.0  |  0.989   |    0.983    |    0.992    |   0.983   |
    |  3.0  |  0.986   |    0.978    |    0.991    |   0.984   |
    |  4.0  |  0.996   |    0.952    |    0.998    |    0.93   |
    |  6.0  |  0.997   |    0.995    |    0.998    |   0.983   |
    +-------+----------+-------------+-------------+—————+

30 breath window majority votes:

    +-------+----------+-------------+-------------+-----------+
    | label | accuracy | sensitivity | specificity | precision |
    +-------+----------+-------------+-------------+-----------+
    |  0.0  |   1.0    |    0.999    |     1.0     |   0.998   |
    |  1.0  |  0.989   |    0.984    |    0.992    |   0.983   |
    |  3.0  |  0.986   |    0.977    |    0.991    |   0.985   |
    |  4.0  |  0.996   |    0.948    |    0.997    |   0.922   |
    |  6.0  |  0.998   |    0.996    |    0.998    |   0.984   |
    +-------+----------+-------------+-------------+—————+

50 breath window majority votes:

    +-------+----------+-------------+-------------+-----------+
    | label | accuracy | sensitivity | specificity | precision |
    +-------+----------+-------------+-------------+-----------+
    |  0.0  |  0.999   |    0.999    |     1.0     |   0.998   |
    |  1.0  |   0.99   |    0.988    |    0.991    |   0.981   |
    |  3.0  |  0.986   |    0.975    |    0.992    |   0.987   |
    |  4.0  |  0.996   |    0.958    |    0.997    |   0.908   |
    |  6.0  |  0.998   |    0.994    |    0.999    |   0.989   |
    +-------+----------+-------------+-------------+—————+

### Votes Based On Confidence.

Conf window 10 frac .9

    +-------+----------+-------------+-------------+-----------+
    | label | accuracy | sensitivity | specificity | precision |
    +-------+----------+-------------+-------------+-----------+
    |  0.0  |  0.999   |    0.999    |    0.998    |   0.992   |
    |  1.0  |  0.984   |    0.969    |    0.991    |   0.981   |
    |  3.0  |  0.982   |    0.978    |    0.985    |   0.974   |
    |  4.0  |  0.996   |    0.945    |    0.998    |   0.937   |
    |  6.0  |  0.998   |    0.995    |    0.998    |   0.986   |
    +-------+----------+-------------+-------------+-----------+

Conf window 10 frac .8

    +-------+----------+-------------+-------------+-----------+
    | label | accuracy | sensitivity | specificity | precision |
    +-------+----------+-------------+-------------+-----------+
    |  0.0  |  0.999   |     1.0     |    0.999    |   0.995   |
    |  1.0  |  0.985   |    0.972    |    0.991    |   0.982   |
    |  3.0  |  0.983   |    0.979    |    0.985    |   0.976   |
    |  4.0  |  0.996   |    0.947    |    0.998    |   0.938   |
    |  6.0  |  0.998   |    0.995    |    0.998    |   0.986   |
    +-------+----------+-------------+-------------+-----------+

Conf window 10 frac .7

    +-------+----------+-------------+-------------+-----------+
    | label | accuracy | sensitivity | specificity | precision |
    +-------+----------+-------------+-------------+-----------+
    |  0.0  |   1.0    |     1.0     |     1.0     |   0.998   |
    |  1.0  |  0.986   |    0.974    |    0.992    |   0.982   |
    |  3.0  |  0.983   |    0.979    |    0.986    |   0.977   |
    |  4.0  |  0.996   |     0.95    |    0.998    |   0.939   |
    |  6.0  |  0.998   |    0.996    |    0.998    |   0.986   |
    +-------+----------+-------------+-------------+-----------+

Conf window 20 frac .9

    +-------+----------+-------------+-------------+-----------+
    | label | accuracy | sensitivity | specificity | precision |
    +-------+----------+-------------+-------------+-----------+
    |  0.0  |  0.999   |     1.0     |    0.998    |   0.992   |
    |  1.0  |  0.985   |    0.971    |    0.991    |   0.981   |
    |  3.0  |  0.983   |    0.978    |    0.986    |   0.977   |
    |  4.0  |  0.996   |    0.946    |    0.998    |   0.937   |
    |  6.0  |  0.998   |    0.995    |    0.998    |   0.986   |
    +-------+----------+-------------+-------------+—————+

Conf window 20 frac .8

    +-------+----------+-------------+-------------+-----------+
    | label | accuracy | sensitivity | specificity | precision |
    +-------+----------+-------------+-------------+-----------+
    |  0.0  |  0.999   |     1.0     |    0.999    |   0.996   |
    |  1.0  |  0.987   |    0.976    |    0.992    |   0.983   |
    |  3.0  |  0.984   |    0.979    |    0.988    |   0.979   |
    |  4.0  |  0.996   |    0.946    |    0.998    |   0.937   |
    |  6.0  |  0.998   |    0.996    |    0.998    |   0.986   |
    +-------+----------+-------------+-------------+—————+

Conf window 20 frac .7

    +-------+----------+-------------+-------------+-----------+
    | label | accuracy | sensitivity | specificity | precision |
    +-------+----------+-------------+-------------+-----------+
    |  0.0  |   1.0    |     1.0     |     1.0     |   0.999   |
    |  1.0  |  0.988   |     0.98    |    0.992    |   0.983   |
    |  3.0  |  0.985   |    0.979    |    0.989    |   0.982   |
    |  4.0  |  0.996   |     0.95    |    0.998    |   0.935   |
    |  6.0  |  0.998   |    0.996    |    0.998    |   0.985   |
    +-------+----------+-------------+-------------+—————+

Conf window 30 frac .9

    +-------+----------+-------------+-------------+-----------+
    | label | accuracy | sensitivity | specificity | precision |
    +-------+----------+-------------+-------------+-----------+
    |  0.0  |  0.999   |     1.0     |    0.998    |   0.991   |
    |  1.0  |  0.985   |    0.972    |    0.991    |   0.982   |
    |  3.0  |  0.983   |    0.978    |    0.986    |   0.978   |
    |  4.0  |  0.996   |    0.947    |    0.998    |   0.936   |
    |  6.0  |  0.998   |    0.996    |    0.998    |   0.987   |
    +-------+----------+-------------+-------------+—————+

Conf window 30 frac .8

    +-------+----------+-------------+-------------+-----------+
    | label | accuracy | sensitivity | specificity | precision |
    +-------+----------+-------------+-------------+-----------+
    |  0.0  |  0.999   |     1.0     |    0.999    |   0.996   |
    |  1.0  |  0.988   |    0.979    |    0.992    |   0.982   |
    |  3.0  |  0.985   |    0.979    |    0.989    |   0.981   |
    |  4.0  |  0.996   |     0.95    |    0.998    |   0.934   |
    |  6.0  |  0.998   |    0.996    |    0.998    |   0.988   |
    +-------+----------+-------------+-------------+—————+

Conf window 30 frac .7

    +-------+----------+-------------+-------------+-----------+
    | label | accuracy | sensitivity | specificity | precision |
    +-------+----------+-------------+-------------+-----------+
    |  0.0  |   1.0    |     1.0     |     1.0     |   0.999   |
    |  1.0  |  0.989   |    0.984    |    0.992    |   0.983   |
    |  3.0  |  0.986   |    0.979    |    0.991    |   0.984   |
    |  4.0  |  0.997   |    0.958    |    0.998    |   0.933   |
    |  6.0  |  0.998   |    0.996    |    0.999    |   0.989   |
    +-------+----------+-------------+-------------+—————+

Conf window 50 frac .9

    +-------+----------+-------------+-------------+-----------+
    | label | accuracy | sensitivity | specificity | precision |
    +-------+----------+-------------+-------------+-----------+
    |  0.0  |  0.999   |     1.0     |    0.998    |   0.992   |
    |  1.0  |  0.986   |    0.974    |    0.991    |   0.982   |
    |  3.0  |  0.984   |    0.978    |    0.987    |   0.979   |
    |  4.0  |  0.996   |    0.947    |    0.998    |   0.936   |
    |  6.0  |  0.998   |    0.996    |    0.998    |   0.987   |
    +-------+----------+-------------+-------------+—————+

Conf window 50 frac .8

    +-------+----------+-------------+-------------+-----------+
    | label | accuracy | sensitivity | specificity | precision |
    +-------+----------+-------------+-------------+-----------+
    |  0.0  |  0.999   |     1.0     |    0.999    |   0.997   |
    |  1.0  |  0.989   |    0.982    |    0.992    |   0.982   |
    |  3.0  |  0.985   |    0.978    |     0.99    |   0.983   |
    |  4.0  |  0.996   |    0.947    |    0.998    |    0.93   |
    |  6.0  |  0.998   |    0.996    |    0.998    |   0.989   |
    +-------+----------+-------------+-------------+—————+

Conf window 50 frac .7

    +-------+----------+-------------+-------------+-----------+
    | label | accuracy | sensitivity | specificity | precision |
    +-------+----------+-------------+-------------+-----------+
    |  0.0  |   1.0    |    0.999    |     1.0     |   0.998   |
    |  1.0  |   0.99   |    0.986    |    0.992    |   0.983   |
    |  3.0  |  0.986   |    0.978    |    0.991    |   0.986   |
    |  4.0  |  0.996   |    0.954    |    0.997    |   0.924   |
    |  6.0  |  0.998   |    0.996    |    0.999    |   0.989   |
    +-------+----------+-------------+-------------+-----------+

## Lookahead
### Methods
Lookahead operates slightly similarly to lookbehind, except when it finds an issue it
looks ahead to subsequent predictions and determines what the current breath should be
based on voting. The main downside to this algorithm is that it introduces additional
latency into breath level predictions if a real time algorithm was desired for use.
Here we evaluated windows sized 10-50 and voting majorities from .5-.7.

Label key:

    0: VC
    1: PC
    3: PS
    4: CPAP
    6: PAV

### Majority Voting Results

Lookahead majority vote 10:

    +-------+----------+-------------+-------------+-----------+
    | label | accuracy | sensitivity | specificity | precision |
    +-------+----------+-------------+-------------+-----------+
    |  0.0  |   1.0    |     1.0     |     1.0     |   0.999   |
    |  1.0  |  0.989   |     0.98    |    0.993    |   0.985   |
    |  3.0  |  0.986   |    0.981    |     0.99    |   0.983   |
    |  4.0  |  0.997   |     0.96    |    0.998    |   0.941   |
    |  6.0  |  0.998   |    0.997    |    0.998    |   0.986   |
    +-------+----------+-------------+-------------+-----------+

Lookahead majority vote 20:

    +-------+----------+-------------+-------------+-----------+
    | label | accuracy | sensitivity | specificity | precision |
    +-------+----------+-------------+-------------+-----------+
    |  0.0  |   1.0    |     1.0     |     1.0     |   0.999   |
    |  1.0  |  0.991   |    0.987    |    0.993    |   0.985   |
    |  3.0  |  0.989   |    0.981    |    0.993    |   0.989   |
    |  4.0  |  0.997   |    0.971    |    0.998    |   0.939   |
    |  6.0  |  0.998   |    0.999    |    0.998    |   0.988   |
    +-------+----------+-------------+-------------+-----------+

Lookahead majority vote 30:

    +-------+----------+-------------+-------------+-----------+
    | label | accuracy | sensitivity | specificity | precision |
    +-------+----------+-------------+-------------+-----------+
    |  0.0  |   1.0    |    0.999    |     1.0     |   0.999   |
    |  1.0  |  0.991   |    0.987    |    0.993    |   0.986   |
    |  3.0  |  0.989   |    0.981    |    0.993    |   0.989   |
    |  4.0  |  0.997   |    0.974    |    0.998    |   0.933   |
    |  6.0  |  0.999   |    0.999    |    0.999    |    0.99   |
    +-------+----------+-------------+-------------+—————+

Lookahead majority vote 50:

    +-------+----------+-------------+-------------+-----------+
    | label | accuracy | sensitivity | specificity | precision |
    +-------+----------+-------------+-------------+-----------+
    |  0.0  |  0.999   |    0.998    |     1.0     |   0.998   |
    |  1.0  |  0.992   |     0.99    |    0.993    |   0.986   |
    |  3.0  |  0.989   |    0.981    |    0.995    |   0.991   |
    |  4.0  |  0.997   |    0.978    |    0.998    |   0.929   |
    |  6.0  |  0.999   |    0.998    |    0.999    |    0.99   |
    +-------+----------+-------------+-------------+-----------+

### Lookahead Confidence Vote

Lookahead win 10 conf .6

    +-------+----------+-------------+-------------+-----------+
    | label | accuracy | sensitivity | specificity | precision |
    +-------+----------+-------------+-------------+-----------+
    |  0.0  |   1.0    |     1.0     |     1.0     |   0.999   |
    |  1.0  |  0.988   |    0.979    |    0.993    |   0.984   |
    |  3.0  |  0.986   |    0.981    |    0.989    |   0.981   |
    |  4.0  |  0.997   |    0.957    |    0.998    |   0.941   |
    |  6.0  |  0.998   |    0.997    |    0.998    |   0.986   |
    +-------+----------+-------------+-------------+—————+

Lookahead win 10 conf .7

    +-------+----------+-------------+-------------+-----------+
    | label | accuracy | sensitivity | specificity | precision |
    +-------+----------+-------------+-------------+-----------+
    |  0.0  |   1.0    |     1.0     |     1.0     |   0.998   |
    |  1.0  |  0.987   |    0.977    |    0.992    |   0.983   |
    |  3.0  |  0.985   |     0.98    |    0.988    |    0.98   |
    |  4.0  |  0.997   |    0.953    |    0.998    |   0.941   |
    |  6.0  |  0.998   |    0.996    |    0.998    |   0.986   |
    +-------+----------+-------------+-------------+—————+

Lookahead win 20 conf .6

    +-------+----------+-------------+-------------+-----------+
    | label | accuracy | sensitivity | specificity | precision |
    +-------+----------+-------------+-------------+-----------+
    |  0.0  |   1.0    |     1.0     |     1.0     |   0.999   |
    |  1.0  |   0.99   |    0.985    |    0.993    |   0.985   |
    |  3.0  |  0.988   |    0.981    |    0.992    |   0.986   |
    |  4.0  |  0.997   |    0.966    |    0.998    |    0.94   |
    |  6.0  |  0.998   |    0.998    |    0.999    |   0.989   |
    +-------+----------+-------------+-------------+—————+

Lookahead win 20 conf .7

    +-------+----------+-------------+-------------+-----------+
    | label | accuracy | sensitivity | specificity | precision |
    +-------+----------+-------------+-------------+-----------+
    |  0.0  |   1.0    |     1.0     |     1.0     |   0.999   |
    |  1.0  |  0.989   |    0.982    |    0.993    |   0.985   |
    |  3.0  |  0.987   |    0.981    |     0.99    |   0.983   |
    |  4.0  |  0.997   |    0.959    |    0.998    |   0.941   |
    |  6.0  |  0.998   |    0.997    |    0.998    |   0.988   |
    +-------+----------+-------------+-------------+—————+

Lookahead win 30 conf .6 (we used this for results)

    +-------+----------+-------------+-------------+-----------+
    | label | accuracy | sensitivity | specificity | precision |
    +-------+----------+-------------+-------------+-----------+
    |  0.0  |   1.0    |    0.999    |     1.0     |   0.999   |
    |  1.0  |  0.991   |    0.987    |    0.993    |   0.986   |
    |  3.0  |  0.989   |    0.981    |    0.993    |   0.989   |
    |  4.0  |  0.997   |    0.974    |    0.998    |   0.937   |
    |  6.0  |  0.999   |    0.998    |    0.999    |    0.99   |
    +-------+----------+-------------+-------------+—————+

Lookahead win 30 conf .7

    +-------+----------+-------------+-------------+-----------+
    | label | accuracy | sensitivity | specificity | precision |
    +-------+----------+-------------+-------------+-----------+
    |  0.0  |   1.0    |     1.0     |     1.0     |   0.999   |
    |  1.0  |   0.99   |    0.985    |    0.993    |   0.985   |
    |  3.0  |  0.988   |    0.981    |    0.992    |   0.986   |
    |  4.0  |  0.997   |    0.964    |    0.998    |    0.94   |
    |  6.0  |  0.999   |    0.998    |    0.999    |    0.99   |
    +-------+----------+-------------+-------------+—————+

Lookahead win 50 conf .6

    +-------+----------+-------------+-------------+-----------+
    | label | accuracy | sensitivity | specificity | precision |
    +-------+----------+-------------+-------------+-----------+
    |  0.0  |  0.999   |    0.999    |     1.0     |   0.998   |
    |  1.0  |  0.992   |     0.99    |    0.994    |   0.987   |
    |  3.0  |  0.989   |    0.981    |    0.995    |   0.991   |
    |  4.0  |  0.997   |    0.977    |    0.998    |    0.93   |
    |  6.0  |  0.999   |    0.999    |    0.999    |   0.991   |
    +-------+----------+-------------+-------------+—————+

Lookahead win 50 conf .7

    +-------+----------+-------------+-------------+-----------+
    | label | accuracy | sensitivity | specificity | precision |
    +-------+----------+-------------+-------------+-----------+
    |  0.0  |   1.0    |    0.999    |     1.0     |   0.998   |
    |  1.0  |  0.991   |    0.987    |    0.994    |   0.986   |
    |  3.0  |  0.988   |    0.981    |    0.993    |   0.988   |
    |  4.0  |  0.997   |    0.965    |    0.998    |   0.932   |
    |  6.0  |  0.999   |    0.999    |    0.999    |   0.991   |
    +-------+----------+-------------+-------------+—————+
